@rendermode InteractiveServer

<NavigationStack @ref="_stack" BaseName="Base Header">
    <BaseContent>
        <h1>Base Content</h1>
        <p>This is the starting point of the navigation stack. The NavigationStack component provides a way to navigate
            through stacked content while maintaining history.</p>
        @if (_data != null) {
            <p>
                Level1: @_data.ValueFromLevel1
            </p>
            <p>
                Level2: @_data.ValueFromLevel2
            </p>
        }
        <button @onclick="ShowLevel1">Select Values</button>
    </BaseContent>
</NavigationStack>

@code {

    private INavigationStack? _stack;
    private Data? _data;

    private class Data {
        public required string ValueFromLevel1 { get; init; }
        public required string ValueFromLevel2 { get; init; }
    }

    private async Task ShowLevel1() {
        if (_stack == null) return;
        string valueFromLevel1 = "";

        async Task Level1Next() {
            NavigationStack.Result<string> level2Result = await ShowLevel2();
            if (level2Result.IsCanceled || level2Result.Value == null) {
                // _stack.Cancel(); //Back to the base content if level2 was canceled
                return;
            }
            _stack.SetResult(new Data() {
                ValueFromLevel1 = valueFromLevel1,
                ValueFromLevel2 = level2Result.Value,
            });
        }

        RenderFragment Content() {
            return __builder => {
                <h1>Level 1 Content</h1>
                <div>
                    <label>Enter value:</label>
                    <input type="text" @bind="valueFromLevel1"/>
                </div>
                <button @onclick="Level1Next">Next</button>
            };
        }

        NavigationStack.Result<Data> result = await _stack.Push<Data>(new StackPage() {
            Content = Content(),
            Name = "Level1",
        });


        _data = result.Value;
    }


    private async Task<NavigationStack.Result<string>> ShowLevel2() {
        if (_stack == null) return NavigationStack.Result<string>.Canceled;
        string value = "";

        void OkClicked() {
            _stack.SetResult(value);
        }

        RenderFragment Content() {
            return __builder => {
                <h1>Level 2 Content</h1>
                <div>
                    <label>Enter value:</label>
                    <input type="text" @bind="value"/>
                </div>
                <button @onclick="OkClicked">Ok</button>
            };
        }

        NavigationStack.Result<string> result = await _stack.Push<string>(new StackPage() {
            Content = Content(),
            Name = "Level2",
        });
        return result;
    }


}